<!DOCTYPE html>
<html>
<head>
    <title>Copying...</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; color: #f5f5f5; background-color: #17212b; }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <p id="status">Đang khởi tạo...</p>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const statusElement = document.getElementById('status');
            
            try {
                const WebApp = window.Telegram.WebApp;
                WebApp.ready();
                statusElement.innerText = "Đang lấy dữ liệu...";

                const textToCopy = WebApp.initDataUnsafe.start_param;

                if (textToCopy) {
                    statusElement.innerText = "Đang sao chép...";
                    navigator.clipboard.writeText(textToCopy).then(function() {
                        // === LOGIC MỚI: KIỂM TRA TRƯỚC KHI GỌI ALERT ===
                        // WebApp.isVersionAtLeast('6.1') sẽ trả về true nếu phiên bản là 6.1 hoặc cao hơn.
                        if (WebApp.isVersionAtLeast('6.1')) {
                            WebApp.showAlert('Đã sao chép link thành công!');
                        }
                        
                        // Luôn luôn đóng sau khi hoàn tất.
                        setTimeout(() => {
                            WebApp.close();
                        }, 200); // Giảm thời gian chờ

                    }).catch(function(err) {
                        if (WebApp.isVersionAtLeast('6.1')) {
                            WebApp.showAlert('Lỗi: Không thể sao chép. ' + err);
                        }
                        setTimeout(() => {
                           WebApp.close();
                        }, 500);
                    });
                } else {
                    if (WebApp.isVersionAtLeast('6.1')) {
                        WebApp.showAlert('Lỗi: Không tìm thấy nội dung để sao chép từ bot.');
                    }
                     setTimeout(() => {
                        WebApp.close();
                    }, 500);
                }

            } catch (e) {
                statusElement.innerText = "Lỗi: Vui lòng mở từ ứng dụng Telegram. " + e.message;
            }
        });
    </script>
</body>
</html>
